(function(){"use strict";function t(){function t(t,e,n=!0){var r=document.createElement("button");r.textContent=t,r.style.display="block",r.style.width="100%",r.style.margin="6px 0",r.style.padding="8px 0",r.style.fontSize="15px",r.style.background="#0078d7",r.style.color="#fff",r.style.border="none",r.style.borderRadius="4px",r.style.cursor="pointer",r.onmouseover=function(){r.style.background="#005fa3"},r.onmouseout=function(){r.style.background="#0078d7"},r.onclick=function(t){t.preventDefault(),e(),n&&l.remove()},l.appendChild(r)}var r=document.getElementById("hilan-float-menu");r&&r.remove();var l=document.createElement("div");l.id="hilan-float-menu",l.style.position="fixed",l.style.top="30px",l.style.right="30px",l.style.background="#fff",l.style.border="2px solid #0078d7",l.style.borderRadius="8px",l.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",l.style.padding="18px 20px 14px 20px",l.style.zIndex=99999,l.style.fontFamily="Segoe UI, Arial, sans-serif",l.style.minWidth="220px";var i=document.createElement("div");i.textContent="Hilan Menu",i.style.fontWeight="bold",i.style.fontSize="18px",i.style.marginBottom="12px",l.appendChild(i),t("Go to Max Hilan",function(){window.open("https://leumicard-sso.net.hilan.co.il/Hilannetv2/Attendance/AttendanceApproval.aspx","_blank")},!0),t("Go to Matrix Hilan",function(){window.open("https://matrix.net.hilan.co.il/Hilannetv2/Attendance/calendarpage.aspx?itemId=47","_blank")},!0),t("Select & Do the Magic",function(){e()},!0),window.addUploadButton&&t("Upload file and do the magic",function(){n()},!0);var o=document.createElement("span");o.textContent="×",o.title="Close",o.style.position="absolute",o.style.top="8px",o.style.right="12px",o.style.cursor="pointer",o.style.fontSize="20px",o.style.color="#888",o.onclick=function(){l.remove()},l.appendChild(o),document.body.appendChild(l)}function e(){document.querySelectorAll('#calendar_container > tbody > tr > td:nth-child(-n+6).cDIES[ondblclick]:not([title*=":"]):not([title*="."]):not([title*=","]):not([title*=" - "])').forEach(t=>t.click());const t=document.querySelector("#H-XSRF-Token");if(!t)return window.addUploadButton=!0,document.querySelector("#ctl00_mp_RefreshSelectedDays").click(),void setTimeout(()=>{Warning("Automation failed: upload the file manually")},1e3);const e=new MutationObserver((e,r)=>{e.forEach(e=>{if("attributes"===e.type&&"tabindex"===e.attributeName){const e=t.getAttribute("tabindex");"0"===e&&(r.disconnect(),n())}})});e.observe(t,{attributes:!0,attributeFilter:["tabindex"]}),document.querySelector("#ctl00_mp_RefreshSelectedDays").click()}function n(){r(function(t){t&&l(t,function(t){if(t){var e=i(t);e&&(console.dir(e),o(e))}})})}function r(t){var e=document.createElement("input");e.type="file",e.accept=".xls,.xlsx,.html,.htm",e.onchange=(e=>{var n=e.target.files[0];n||alert("No file selected."),t(n)}),e.click()}function l(t,e){let n=new FileReader;n.onload=function(t){var n=t.target.result;if(!n||n.length<100)return alert("File appears empty or invalid."),n;e(n)},n.onerror=function(){alert("Error reading file."),e(null)},n.readAsText(t)}function i(t){var e=document.createElement("html");try{e.innerHTML=t;var n=e.querySelectorAll("body > div > table > tbody > tr:has(td)");if(!n||0===n.length)return void alert("No valid rows found in report.");var r=Array.prototype.slice.call(n).filter(t=>{try{return""===t.querySelector("td:nth-child(8)").innerText||"עבודה מהבית /מחוץ למשרד"===t.querySelector("td:nth-child(8)").innerText||"תקלה טכנית"===t.querySelector("td:nth-child(8)").innerText||"החתמה כפולה"===t.querySelector("td:nth-child(8)").innerText}catch(t){return!1}});if(0===r.length)return void alert("No working days found in report.");var l={};r.forEach(t=>{try{var e=t.querySelector("td:nth-child(1)").innerText.match(/\d+\/\d+(\/\d+)?/);if(!e)return;var n=e[0].substring(0,5),r=t.querySelector("td:nth-child(5)").innerText,i=t.querySelector("td:nth-child(6)").innerText,o=t.querySelector("td:nth-child(7)")?t.querySelector("td:nth-child(7)").innerText:"";l[n]||(l[n]={periods:[],durations:[]}),l[n].periods.push({start:r,end:i}),o&&l[n].durations.push(o)}catch(t){}});var i=[];for(const[t,{periods:e,durations:n}]of Object.entries(l)){const r=e.filter((t,e,r)=>{if("00:00"===t.start&&n.includes(t.end))return!1;if(n.includes(t.start)&&n.includes(t.end))return!1;for(let r=0;r<e;r++)if(t.start===n[r]){let e=0;for(let t=0;t<=r;t++){const r=n[t];if(r&&r.includes(":")){const[t,n]=r.split(":").map(Number);e+=60*t+n}}if(n[r+1]&&n[r+1].includes(":")){const[t,l]=n[r+1].split(":").map(Number);e+=60*t+l}const l=Math.floor(e/60),i=e-60*l,o=l.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0");if(t.end===o)return!1}return!0});i.push({date:t,timePeriods:r})}return 0===i.length?(alert("No valid time periods found after filtering."),null):i}catch(t){return alert("Error parsing report file."),null}}function o(t){var e=Array.prototype.slice.call(document.querySelectorAll("form > div.rtl.h-master-outerpage.container-fluid > div:nth-child(6) > div > div.ml-0.mr.mt.row > div > div > div > div.rtl.alignright > div > table > tbody > tr:nth-child(2) > td > div.GBC.ltr.alignleft > div > table > tbody > tr"));e&&0!==e.length?e.forEach(e=>{var n=e.querySelector("td.regularItemCell.ItemBorder > span");if(n){var r=n.innerText.replace(/[^\d\/]+/,""),l=t.find(t=>t.date===r);if(l){var i=e.nextSibling;l.timePeriods.forEach((t,e)=>{try{e>0&&(setTimeout(function(){var t="DO NOT ERASE";t=t.substring(0,t.length),t+=""},100),i.querySelector("td.BBCG.ImageCell > span > input[type=image]").click()),i.querySelector("td:nth-child(2) > table > tbody > tr:nth-child("+(e+1)+") > td:nth-child(3) > table > tbody > tr:nth-child(1) > td:nth-child(3) > span").click(),i.querySelector("td:nth-child(2) > table > tbody > tr:nth-child("+(e+1)+") > td:nth-child(7) > input").value=t.start,i.querySelector("td:nth-child(2) > table > tbody > tr:nth-child("+(e+1)+") > td:nth-child(8) > input").value=t.end}catch(t){}})}}}):alert("No form rows found to fill.")}t()})();
