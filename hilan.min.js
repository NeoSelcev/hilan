(function(){"use strict";function t(){function t(){var t=window.location.hostname;return"leumicard-sso.net.hilan.co.il"===t?"max":"matrix.net.hilan.co.il"===t?"matrix":"other"}function r(t,e,n=!0){var r=document.createElement("button");r.textContent=t,r.style.display="block",r.style.width="100%",r.style.margin="10px 0",r.style.padding="12px 16px",r.style.fontSize="16px",r.style.background="linear-gradient(90deg, #4f8cff 0%, #7bb6ff 100%)",r.style.color="#fff",r.style.border="none",r.style.borderRadius="8px",r.style.cursor="pointer",r.style.fontWeight="600",r.style.boxShadow="0 2px 8px rgba(80,120,255,0.10)",r.style.transition="background 0.18s cubic-bezier(.4,0,.2,1), transform 0.12s",r.style.direction="ltr",r.style.textAlign="center",r.onmouseover=function(){r.style.background="linear-gradient(90deg, #7bb6ff 0%, #4f8cff 100%)",r.style.transform="scale(1.03)"},r.onmouseout=function(){r.style.background="linear-gradient(90deg, #4f8cff 0%, #7bb6ff 100%)",r.style.transform="scale(1)"},r.onclick=function(t){t.preventDefault(),e(),n&&o.remove()},o.appendChild(r)}var l=document.getElementById("hilan-float-menu");if(l)l.remove();else{var o=document.createElement("div");o.id="hilan-float-menu",o.style.position="fixed",o.style.top="32px",o.style.right="32px",o.style.background="rgba(30, 34, 44, 0.85)",o.style.backdropFilter="blur(12px)",o.style.border="1.5px solid rgba(80, 120, 255, 0.25)",o.style.borderRadius="18px",o.style.boxShadow="0 8px 32px 0 rgba(31, 38, 135, 0.25)",o.style.padding="26px 28px 20px 28px",o.style.zIndex=99999,o.style.fontFamily="Segoe UI, Arial, sans-serif",o.style.minWidth="250px",o.style.color="#f3f6fa",o.style.transition="all 0.2s cubic-bezier(.4,0,.2,1)";var i=document.createElement("div");i.textContent="Hilan Menu",i.style.fontWeight="bold",i.style.fontSize="22px",i.style.marginBottom="16px",i.style.letterSpacing="0.5px",i.style.color="#7bb6ff",i.style.textShadow="0 2px 8px rgba(80,120,255,0.10)",i.style.textAlign="left",o.appendChild(i);var a=t();"max"===a?(r('Max Hilan - Go to "Daily report"',function(){window.location.href="https://leumicard-sso.net.hilan.co.il/Hilannetv2/Attendance/calendarpage.aspx"},!0),r('Max Hilan - Go to "Download monthly report"',function(){window.location.href="https://leumicard-sso.net.hilan.co.il/Hilannetv2/Attendance/AttendanceApproval.aspx"},!0),r("Go to Matrix Hilan",function(){window.open("https://matrix.net.hilan.co.il/Hilannetv2/Attendance/calendarpage.aspx?itemId=47","_blank")},!0)):"matrix"===a?(r('Max Hilan - Go to "Daily report"',function(){window.open("https://leumicard-sso.net.hilan.co.il/Hilannetv2/Attendance/calendarpage.aspx","_blank")},!0),r('Matrix Hilan - Go to "Daily report"',function(){window.location.href="https://matrix.net.hilan.co.il/Hilannetv2/Attendance/calendarpage.aspx?itemId=47"},!0),r("Matrix Hilan - Select month",function(){e()},!0),r("Matrix Hilan - Upload and Do the Magic",function(){n()},!0)):(r('Max Hilan - Go to "Daily report"',function(){window.open("https://leumicard-sso.net.hilan.co.il/Hilannetv2/Attendance/calendarpage.aspx","_blank")},!0),r("Go to Matrix Hilan",function(){window.open("https://matrix.net.hilan.co.il/Hilannetv2/Attendance/calendarpage.aspx?itemId=47","_blank")},!0));var c=document.createElement("span");c.textContent="×",c.title="Close",c.style.position="absolute",c.style.top="12px",c.style.right="18px",c.style.cursor="pointer",c.style.fontSize="26px",c.style.color="#7bb6ff",c.style.fontWeight="bold",c.style.textShadow="0 2px 8px rgba(80,120,255,0.15)",c.onmouseover=function(){c.style.color="#fff"},c.onmouseout=function(){c.style.color="#7bb6ff"},c.onclick=function(){o.remove()},o.appendChild(c),document.body.appendChild(o)}}function e(){var t=setTimeout(function(){clearInterval(t);const e=document.querySelector("#H-XSRF-Token");if(e){document.querySelector("#ctl00_mp_RefreshSelectedDays").click();var n=0,r=50,l=setInterval(function(){var t=document.querySelector("body > .h-loading-app-backdrop");n++,t?n>=r&&(clearInterval(l),confirm("Month selection completed. But UI is not responsive, so upload the report when the page will finish updating.")):(clearInterval(l),confirm("Month selection completed. You can now upload a report."))},100)}},100);document.querySelectorAll('#calendar_container > tbody > tr > td:nth-child(-n+6).cDIES[ondblclick]:not(.CSD):not([title*=":"]):not([title*="."]):not([title*=","]):not([title*=" - "]), #calendar_container > tbody > tr > td:nth-child(-n+6).cED[ondblclick]:not(.CSD):not([title*=":"]):not([title*="."]):not([title*=","]):not([title*=" - "])').forEach(t=>t.click()),document.querySelector("#ctl00_mp_RefreshSelectedDays").click()}function n(){r(function(t){t&&l(t,function(t){if(t){var e=o(t);e&&(console.dir(e),i(e))}})})}function r(t){var e=document.createElement("input");e.type="file",e.accept=".xls,.xlsx,.html,.htm",e.onchange=(e=>{var n=e.target.files[0];n||alert("No file selected."),t(n)}),e.click()}function l(t,e){let n=new FileReader;n.onload=function(t){var n=t.target.result;if(!n||n.length<100)return alert("File appears empty or invalid."),n;e(n)},n.onerror=function(){alert("Error reading file."),e(null)},n.readAsText(t)}function o(t){var e=document.createElement("html");try{e.innerHTML=t;var n=e.querySelectorAll("body > div > table > tbody > tr:has(td)");if(!n||0===n.length)return void alert("No valid rows found in report.");var r=Array.prototype.slice.call(n).filter(t=>{try{return""===t.querySelector("td:nth-child(8)").innerText||"עבודה מהבית /מחוץ למשרד"===t.querySelector("td:nth-child(8)").innerText||"תקלה טכנית"===t.querySelector("td:nth-child(8)").innerText||"החתמה כפולה"===t.querySelector("td:nth-child(8)").innerText}catch(t){return!1}});if(0===r.length)return void alert("No working days found in report.");var l={};r.forEach(t=>{try{var e=t.querySelector("td:nth-child(1)").innerText.match(/\d+\/\d+(\/\d+)?/);if(!e)return;var n=e[0].substring(0,5),r=t.querySelector("td:nth-child(5)").innerText,o=t.querySelector("td:nth-child(6)").innerText,i=t.querySelector("td:nth-child(7)")?t.querySelector("td:nth-child(7)").innerText:"";l[n]||(l[n]={periods:[],durations:[]}),l[n].periods.push({start:r,end:o}),i&&l[n].durations.push(i)}catch(t){}});var o=[];for(const[t,{periods:e,durations:n}]of Object.entries(l)){const r=e.filter((t,e,r)=>{if("00:00"===t.start&&n.includes(t.end))return!1;if(n.includes(t.start)&&n.includes(t.end))return!1;for(let r=0;r<e;r++)if(t.start===n[r]){let e=0;for(let t=0;t<=r;t++){const r=n[t];if(r&&r.includes(":")){const[t,n]=r.split(":").map(Number);e+=60*t+n}}if(n[r+1]&&n[r+1].includes(":")){const[t,l]=n[r+1].split(":").map(Number);e+=60*t+l}const l=Math.floor(e/60),o=e-60*l,i=l.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0");if(t.end===i)return!1}return!0});o.push({date:t,timePeriods:r})}return 0===o.length?(alert("No valid time periods found after filtering."),null):o}catch(t){return alert("Error parsing report file."),null}}function i(t){var e=Array.prototype.slice.call(document.querySelectorAll("form > div.rtl.h-master-outerpage.container-fluid > div > div > div > div.ml-0.mr.mt.row > div > div > div > div.rtl.alignright > div > div > table > tbody > tr:nth-child(2) > td > div.GBC.ltr.alignleft > div > table > tbody > tr"));if(e&&0!==e.length)for(var n=0;n<e.length;n++){var r=e[n],l=r.querySelector("td.regularItemCell.ItemBorder > span");if(l){var o=l.innerText.replace(/[^\d\/]+/,"");if(t.length>0){var i=o.substring(3),a=t[0].date.substring(3);if(i!==a){alert("Error: Month mismatch. The form shows "+i+" but the uploaded report is for "+a+". Please select the correct month or upload the correct report.");break}}var c=t.find(t=>t.date===o);if(c){var d=r.nextSibling;c.timePeriods.forEach((t,e)=>{try{t.start&&t.end&&(e>0&&(setTimeout(function(){var t="DO NOT ERASE";t=t.substring(0,t.length),t+=""},100),d.querySelector("td.BBCG.ImageCell > span > span.fh-plus-b").click(),setTimeout(function(){var t="DO NOT ERASE";t=t.substring(0,t.length),t+=""},100)),d.querySelector("td:nth-child(2) > table > tbody > tr:nth-child("+(e+1)+") > td:nth-child(3) > table > tbody > tr:nth-child(1) > td:nth-child(3) > span").click(),d.querySelector("td:nth-child(2) > table > tbody > tr:nth-child("+(e+1)+") > td:nth-child(7) > input").value=t.start,d.querySelector("td:nth-child(2) > table > tbody > tr:nth-child("+(e+1)+") > td:nth-child(8) > input").value=t.end)}catch(t){}})}}}else alert("No form rows found to fill.")}t()})();